### Freedom Finance Europe Report Parser
#### О программе

Эта программа предназначена для обработки брокерских отчетов компании Freedom Finance Europe c целью подготовки налоговой отчетности для Государственной налоговой службы Украины. В соответствии со статьей 170 пунктом 2 Налогового кодекса Украины: "Инвестиционная прибыль рассчитывается как положительная разница между доходом, полученным налогоплательщиком от продажи отдельного инвестиционного актива с учетом курсовой разницы (при наличии), и его стоимостью, которая определяется из суммы документально подтвержденных расходов на приобретение такого актива с учетом норм подпунктов 170.2.4-170.2.6 этого пункта  (кроме операций с дерривативами)".
К сожалению, несмотря на то, что брокерские отчеты дают детальную информацию о сделанных инвестиционных операциях, в них не учитывается курcовая разница на дату покупки/продажи актива. Также при отображении закрытых сделок,  брокер указывает усредненную сумму покупок актива за все время, что не позволяет правильно определить ценовую разницу и не учитывает сумму брокерских комиссии, которые согласно вышеприведенному требованию, необходимо учитывать в расчете. Данная программа имеет встроенную интеграцию с API Национального Банка Украины для получения актуальных валютных курсов по дате покупки/продажи и выплаты дивидендов.

#### Использование и запуск:
Команда вляется исполняемым бинарным файлом и предназначена для запуска из коммандной строки. Опции запуска приведены ниже:
  - -end  	День начала для расчета в формате ГГГГ-ММ-ДД.
  - -start     	День начала для расчета в формате ГГГГ-ММ-ДД.
  - -lang     	Язык отчета. Поддерживаемые языки: UA, RU, EN. (по умолчанию "EN")
  - -output     	Имя xlsx файла с результатами (по умолчанию "tax_calculation.xlsx")
  - -report     	Путь к файлу JSON отчета брокера FF. (Обязательно)

Пример запуска на MacOS/Linux
> ./ffparser -report=full-report.json -start=2020-08-01 -lang=UA -output=results.xlsx

#### Особенности расчетов
Для правильного рассчета результатов сделок, независимо от периода который будет декларироваться, необходимо использовать полный отчет за все время работы начиная с дня открытия брокерского счета, так например, актив проданный в 2021 году мог быть приобретен в 2020 году и для рассчета закрытой сделки необходимы все данные. Программа проводит рассчеты дохода от операций купли.продажи активов и получения дивидендов. Сумма налога рассчитывается по следующим ставкам:
- 18% НДФЛ
- 1.55 Военный сбор
- 9% Дивидендный доход

Важно отметить, что программа работает коректно только с "long"позициями, при наличии "short" позиции рассчет может быть неверен. Также следует учесть, что она не учитывает особенности декларирования приведенные в подпунктах [170.2.4-170.2.6](https://zakon.rada.gov.ua/laws/show/2755-17?lang=ru#n3998) и в случае наличия таких операций сумма указываемая в декларации должна быть отредактирована вручную.

####Формат рассчета
Результаты рассчетов предоставлены в виде xlsx файла с тремя вкладками:
- Трейдинг - первая вкладка с результатами расчета дохода от купли/продажи активов
- Дивиденды - вторая вкладка со списком начисленных за период дивидендов
- Налоги - третья вкладка с рассчетом налоговых обязательств

Следует учесть, что при наличии сплита акций, все операции по акции пересчитываются и отображаются со значениями после сплита, если тикер акции был переименован все операции по бумаге будут отображаться со значением тикера после сплита. Например:
- 1 января куплена 2 бумаги TEST стоимостью 300$
- 2 января продана бумага TEST стоимостью 300$
- 3 января  произошел сплит 1 TEST 300$-> 3 BEST 100$
- 4 января продана 1 бумага TEST стоимостью 100$

В итоговом отчете будет отображено две закрытых сделки
| Тикер | Дата покупки | Количество | Цена покупки | Дата продажи | Цена продажи |
--------|--------------|------------|--------------|--------------|--------------|
| BEST | 1 января | 3 | 100$ | 2 января | 100$ |
| BEST | 1 января | 1 | 100$ | 2 января | 100$ |
