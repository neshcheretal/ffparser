### FF Broker Report Parser
#### Про програму

Ця програма призначена для обробки брокерських звітів компанії Freedom Finance Europe c метою підготовки податкової звітності для Державної податкової служби України. Відповідно до статті 170 пункту 2 Податкового кодексу України: "Інвестиційний прибуток розраховується як позитивна різниця між доходом, отриманим платником податку від продажу окремого інвестиційного активу з урахуванням курсової різниці (за наявності), та його вартістю, що визначається із суми документально підтверджених витрат на придбання такого активу з урахуванням норм підпунктів 170.2.4-170.2.6 цього пункту (крім операцій з деривативами)".
На жаль, незважаючи на те, що брокерські звіти дають детальну інформацію про зроблені інвестиційні операції, в них не враховується курcовая різниця на дату купівлі/продажу активу. Також при відображенні закритих угод, брокер вказує усереднену суму покупок активу за весь час, що не дозволяє правильно визначити цінову різницю і не враховує суму брокерських комісій, які згідно з вищенаведеними вимогами, необхідно враховувати в розрахунку. Програма має вбудовану інтеграцію з API Національного Банку України для отримання актуальних валютних курсів на дату купівлі/продажу та виплати дивідендів.

#### Використання та запуск:
Програма є виконуваним бінарним файлом і призначена для запуску з командного рядка. Опції запуску наведені нижче:
  - -year     	 Календарний рік для якого буде проведено розрахунок. (Обов'язково)
  - -lang     	Мова звіту. Мови: UA, RU, EN. (За замовчуванням "EN")
  - -output     	Ім'я xlsx файлу з результатами (за замовчуванням "tax_calculation.xlsx")
  - -report     	Шлях до JSON файлу звіту брокера Freedom Finance. (Обов'язково)

Приклад запуску для MacOS/Linux
> ./ffparser -report=full-report.json -year=2020 -lang=UA -output=results.xlsx

#### Як отримати брокерський звіт
Щоб отримати брокерський звіт, вам необхідно увійти в торговий термінал Freedom Finance Europe і виконати наступну послідовність дій:

Меню > Кабінет > ОТЧЕТЫ БРОКЕРА > ОТЧЕТ БРОКЕРА > Звіт за період

Період ПОВИНЕН бути встановлений з дня відкриття брокерського рахунку. Потім виберіть формат JSON і завантажте файл.

#### Особливості розрахунків
Для правильного розрахунку результатів угод, незалежно від періоду який буде декларуватися, необхідно використовувати повний звіт за весь час роботи починаючи з дня відкриття брокерського рахунку, так наприклад, актив проданий у 2021 році міг бути придбаний в 2020 році і для розрахунку закритої угоди необхідні всі дані від початку торгівлі. Програма проводить розрахунки доходу від операцій купівлі/продажу активів і отримання дивідендів. Сума податку розраховується за такими ставками:
- 18% ПДФО
- 1.55 Військовий збір
- 9% Дивідендний дохід

Важливо відзначити, що програма працює коректно лише з "long" позиціями, при наявності "short" позиції розрахунок може бути помилковим. Також слід врахувати, що вона не враховує особливості декларування наведені в підпунктах  [170.2.4-170.2.6](https://zakon.rada.gov.ua/laws/show/2755-17?lang=ru#n3998) і в разі наявності таких операцій сума, що вказується в декларації повинна бути відкоригована вручну.

#### Формат розрахунку
Результати розрахунків надані у вигляді xlsx файлу з трьома вкладками:
- Трейдинг - перша вкладка з результатами розрахунку доходу від купівлі / продажу активів
- Дивіденди - друга вкладка зі списком нарахованих за період дивідендів
- Податки - третя вкладка з розрахунком податкових зобов'язань

Слід врахувати, що при наявності спліта акцій, всі операції по акції перераховуються і відображаються зі значеннями після спліту, якщо тікер акції був перейменований всі операції по акції будуть відображатися зі значенням тікера після спліту. Наприклад:
- 1 січня купівля 2 акцій TEST вартістю 300 $
- 2 січня продаж акції TEST вартістю 300 $
- 3 січня стався спліт 1 TEST 300 $ -> 3 BEST 100 $
- 4 січня продаж акції  TEST вартістю 100 $

У підсумковому звіті буде відображено дві закритих угоди
| Тікер | Дата покупки | Кількість | Ціна покупки | Дата продажу | Ціна продажу |
--------|--------------|------------|--------------|--------------|--------------|
| BEST | 1 січня | 3 | 100$ | 2 січня | 100$ |
| BEST | 1 січня | 1 | 100$ | 2 січня | 100$ |
